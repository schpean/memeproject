<!DOCTYPE html>
<html>
<head>
    <title>Meme Image Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h2 {
            margin-top: 0;
        }
        img {
            max-width: 100%;
            border: 1px solid #eee;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Meme Image Loading Test</h1>
    
    <div class="test-section">
        <h2>External Meme (imgflip.com)</h2>
        <p>Testing external image URL from imgflip:</p>
        <img src="https://i.imgflip.com/9pv2ly.jpg" alt="External Meme" 
             onerror="this.parentNode.innerHTML += '<p class=\'error\'>Failed to load external image</p>'; console.error('Failed to load external image');">
        <p id="external-status"></p>
    </div>
    
    <div class="test-section">
        <h2>API Endpoint Test</h2>
        <div id="api-result">Testing connection to API...</div>
    </div>
    
    <div class="test-section">
        <h2>CORS Test</h2>
        <div id="cors-test">Testing CORS settings...</div>
    </div>
    
    <div class="test-section">
        <h2>Direct Image URL Test</h2>
        <p>Testing direct URL load with different image URLs:</p>
        <div id="direct-images"></div>
    </div>
    
    <script>
        // Log browser info
        console.log('Browser information:', navigator.userAgent);
        
        // Test direct image URLs
        const directImagesDiv = document.getElementById('direct-images');
        const testUrls = [
            'https://i.imgflip.com/9pv2ly.jpg',
            'http://86.120.25.207:1337/uploads/1713373661802.jpg',
            'http://86.120.25.207:1337/images/placeholder-meme.jpg' 
        ];
        
        testUrls.forEach(url => {
            console.log('Testing direct image URL:', url);
            const wrapper = document.createElement('div');
            wrapper.style.marginBottom = '20px';
            
            const urlText = document.createElement('p');
            urlText.textContent = url;
            wrapper.appendChild(urlText);
            
            const img = document.createElement('img');
            img.src = url;
            img.alt = 'Test image';
            img.style.maxWidth = '300px';
            img.style.border = '1px solid #ccc';
            
            img.onload = function() {
                console.log('Image loaded successfully:', url);
                urlText.innerHTML += ' <span class="success">(Loaded successfully)</span>';
            };
            
            img.onerror = function() {
                console.error('Failed to load image:', url);
                urlText.innerHTML += ' <span class="error">(Failed to load)</span>';
            };
            
            wrapper.appendChild(img);
            directImagesDiv.appendChild(wrapper);
        });
        
        // Test CORS
        fetch('http://86.120.25.207:1337/memes', {
            method: 'OPTIONS',
            headers: {
                'Origin': window.location.origin
            }
        })
        .then(response => {
            document.getElementById('cors-test').innerHTML = 
                `<p>CORS Preflight Response Status: ${response.status}</p>
                 <p>CORS Headers:</p>
                 <pre>${JSON.stringify(Object.fromEntries([...response.headers]), null, 2)}</pre>`;
            console.log('CORS test response:', response);
        })
        .catch(error => {
            document.getElementById('cors-test').innerHTML = 
                `<p class="error">CORS Test Error: ${error.message}</p>`;
            console.error('CORS test error:', error);
        });
        
        // Test API connection
        fetch('http://86.120.25.207:1337/memes')
            .then(response => {
                console.log('API response status:', response.status);
                console.log('API response headers:', Object.fromEntries([...response.headers]));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('API data received:', data);
                const apiResult = document.getElementById('api-result');
                apiResult.innerHTML = `<p class="success">API connection successful! Found ${data.length} memes.</p>`;
                
                if (data.length > 0) {
                    const firstMeme = data[0];
                    console.log('First meme details:', firstMeme);
                    apiResult.innerHTML += `
                        <h3>First Meme Details:</h3>
                        <p>ID: ${firstMeme.id}</p>
                        <p>Company: ${firstMeme.company}</p>
                        <p>Image URL: ${firstMeme.image_url}</p>
                        <p>Votes: ${firstMeme.votes}</p>
                        <h3>Image Preview:</h3>
                    `;
                    
                    const img = document.createElement('img');
                    img.src = firstMeme.image_url;
                    img.alt = "First Meme";
                    
                    img.onload = function() {
                        console.log('Meme image loaded successfully:', firstMeme.image_url);
                    };
                    
                    img.onerror = function() {
                        console.error('Failed to load meme image:', firstMeme.image_url);
                        apiResult.innerHTML += '<p class="error">Failed to load API image. Check console for details.</p>';
                    };
                    
                    apiResult.appendChild(img);
                }
            })
            .catch(error => {
                console.error('API fetch error:', error);
                document.getElementById('api-result').innerHTML = `<p class="error">Error: ${error.message}</p>`;
            });
    </script>
</body>
</html> 